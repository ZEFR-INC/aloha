
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 2016-06-19
 Rendered using Reflow Maven Skin 1.1.1 (http://andriusvelykis.github.io/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>Constructing Datasets via CLI | aloha</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="" />
		<meta http-equiv="content-language" content="en" />
 
		<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet" />
		<link href=".//css/docs.css" rel="stylesheet" />
		<link href=".//css/reflow-skin.css" rel="stylesheet" />


		<link href=".//css/lightbox.css" rel="stylesheet" />

		<link href=".//css/site.css" rel="stylesheet" />
		<link href=".//css/print.css" rel="stylesheet" media="print" />

		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->


		
<link rel="stylesheet" href=".//css/highlight/github.css"/>
	</head>

	<body class="page-dataset project-aloha" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

		<div class="navbar navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target="#top-nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href="index.html"><span class="color-highlight">Aloha</span></a>
					<div class="nav-collapse collapse" id="top-nav-collapse">
						<ul class="nav pull-right">
							<li ><a href="http://github.com/eharmony/aloha/" title="Code on GitHub" class="externalLink">Code on GitHub</a></li>
							<li ><a href="https://waffle.io/eHarmony/aloha" title="Track Development" class="externalLink">Track Development</a></li>
							<li class="dropdown active">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="getting_started.html" title="Getting Started">Getting Started</a></li>
									<li class="active"><a href="" title="Creating Datasets">Creating Datasets</a></li>
									<li ><a href="model_formats.html" title="JSON Model Formats">JSON Model Formats</a></li>
									<li ><a href="in_depth_walkthrough.html" title="In Depth Walkthrough">In Depth Walkthrough</a></li>
								</ul>
							</li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>

	<div class="container">

	<!-- Masthead
	================================================== -->

	<header>
		<hr class="toc-separator" />
		<div id="toc-bar" class="navbar" data-spy="affix" data-offset-top="40">
			<div class="navbar-inner">
				<div id="toc-scroll-target" class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target="#toc-nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<div class="nav-collapse collapse" id="toc-nav-collapse">
						<ul id="toc" class="nav">
						<li class="toplevel"><a href="#constructing_datasets_via_cli" title="Constructing Datasets via CLI">Constructing Datasets via CLI</a></li>
						<li class="dropdown">
							<a href="#Prerequisites" title="Prerequisites" class="dropdown-toggle" role="button" data-toggle="dropdown" data-target="#">Prerequisites <b class="caret"></b></a>
							<ul class="dropdown-menu" role="menu">
								<!-- Repeat the item, otherwise it is not clickable as the dropdown root -->
								<li><a href="#Prerequisites" title="Prerequisites">Prerequisites</a></li>
								<li class="divider"></li>
								<li><a href="#Get_CLI_Jar_and_aloha-cli_script" title="Get CLI Jar and aloha-cli script">Get CLI Jar and aloha-cli script</a></li>
								<li><a href="#Copy_the_CLI_script_to_some_place_your_system_path" title="Copy the CLI script to some place your system path">Copy the CLI script to some place your system path</a></li>

							</ul>
						</li>
						<li class="dropdown">
							<a href="#Getting_Acquainted" title="Getting Acquainted" class="dropdown-toggle" role="button" data-toggle="dropdown" data-target="#">Getting Acquainted <b class="caret"></b></a>
							<ul class="dropdown-menu" role="menu">
								<!-- Repeat the item, otherwise it is not clickable as the dropdown root -->
								<li><a href="#Getting_Acquainted" title="Getting Acquainted">Getting Acquainted</a></li>
								<li class="divider"></li>
								<li><a href="#A_Look_at_the_CLI" title="A Look at the CLI">A Look at the CLI</a></li>

							</ul>
						</li>
						<li class="dropdown">
							<a href="#Examples" title="Examples" class="dropdown-toggle" role="button" data-toggle="dropdown" data-target="#">Examples <b class="caret"></b></a>
							<ul class="dropdown-menu" role="menu">
								<!-- Repeat the item, otherwise it is not clickable as the dropdown root -->
								<li><a href="#Examples" title="Examples">Examples</a></li>
								<li class="divider"></li>
								<li class="dropdown-submenu">
									<a href="#CSV_Input_Transformed_CSV_output" title="CSV Input, Transformed CSV output">CSV Input, Transformed CSV output</a>
									<ul class="dropdown-menu" role="menu">
								<li><a href="#Command_and_Results" title="Command and Results">Command and Results</a></li>
								<li><a href="#Files" title="Files">Files</a></li>
								<li><a href="#External_CSV_input_format_description" title="External CSV input format description">External CSV input format description</a></li>

									</ul>
								</li>
								<li><a href="#Protocol_Buffer_input_Vowpal_Wabbit_output" title="Protocol Buffer input, Vowpal Wabbit output">Protocol Buffer input, Vowpal Wabbit output</a></li>

							</ul>
						</li>
						<li class="dropdown">
							<a href="#aOutput_specification_files" title="(Output) specification files" class="dropdown-toggle" role="button" data-toggle="dropdown" data-target="#">(Output) specification files <b class="caret"></b></a>
							<ul class="dropdown-menu" role="menu">
								<!-- Repeat the item, otherwise it is not clickable as the dropdown root -->
								<li><a href="#aOutput_specification_files" title="(Output) specification files">(Output) specification files</a></li>
								<li class="divider"></li>
								<li><a href="#Common_fields" title="Common fields">Common fields</a></li>
								<li><a href="#CSV-specific_fields" title="CSV-specific fields">CSV-specific fields</a></li>
								<li><a href="#features" title="features">features</a></li>
								<li><a href="#A_word_of_sparse_formats" title="A word of sparse formats">A word of sparse formats</a></li>
								<li><a href="#Multiple_dataset_formats" title="Multiple dataset formats">Multiple dataset formats</a></li>

							</ul>
						</li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</header>

	<div class="main-body">
	<div class="row">
		<div class="span12">
			<div class="body-content">
				<div class="page-header">
 <h1 id="constructing_datasets_via_cli">Constructing Datasets via CLI</h1>
</div> 
<div class="section"> 
 <h2 id="Prerequisites">Prerequisites</h2> 
 <p><b>A quick note</b>: <i>All examples will assume you’ve check out Aloha from GitHub and built it from source.</i> This is so that you can reuse data in the testing code. You can download and build via: </p> 
 <div class="source"> 
  <div class="source"> 
   <pre>git clone git@github.com:eHarmony/aloha.git
cd aloha
mvn clean install
</pre> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="Get_CLI_Jar_and_aloha-cli_script">Get CLI Jar and <i>aloha-cli</i> script</h3> 
  <p>In reality, you’ll probably not want to download the source and build from scratch to use Aloha to create a dataset. You can get a few different ways. For instance: </p> 
  <ol style="list-style-type: decimal"> 
   <li>If you have the Aloha source code, just do an <tt>mvn clean install</tt> and look for the <tt>aloha-cli-[X.Y.Z]-jar-with-dependencies.jar</tt> in <tt>$HOME/.m2/repository/com/eharmony/aloha-cli/[X.Y.Z]/aloha-cli-[X.Y.Z]-jar-with-dependencies.jar</tt></li> 
   <li>If you are using a project that has an Aloha Maven dependency, <tt>aloha-cli-[X.Y.Z]-jar-with-dependencies.jar</tt> may already be present at <tt>$HOME/.m2/repository/com/eharmony/aloha-cli/[X.Y.Z]/aloha-cli-[X.Y.Z]-jar-with-dependencies.jar</tt></li> 
   <li>If you are not currently using Aloha in a project but just want the CLI functionality, you can download the <tt>aloha-cli-[X.Y.Z]-jar-with-dependencies.jar</tt> from <a class="externalLink" href="http://search.maven.org/#search%7Cga%7C1%7Ccom.eharmony.aloha-cli">Maven Central</a>. Just click <a class="externalLink" href="http://search.maven.org/#search%7Cga%7C1%7Ccom.eharmony.aloha-cli">here</a>, then click the <tt>jar-with-dependencies.jar</tt> link to download the latest Jar file with all of the dependencies included.</li> 
  </ol> 
 </div> 
 <div class="section"> 
  <h3 id="Copy_the_CLI_script_to_some_place_your_system_path">Copy the CLI script to some place your system path</h3> 
  <div class="source"> 
   <div class="source"> 
    <pre>curl -fsSL https://raw.githubusercontent.com/eHarmony/aloha/master/aloha-cli/bin/aloha-cli
</pre> 
   </div> 
  </div> 
 </div> 
</div> 
<div class="section"> 
 <h2 id="Getting_Acquainted">Getting Acquainted</h2> 
 <div class="section"> 
  <h3 id="A_Look_at_the_CLI">A Look at the CLI</h3> 
  <p><span class="label">Input</span></p> 
  <div class="source"> 
   <div class="source"> 
    <pre>aloha-cli/bin/aloha-cli
</pre> 
   </div> 
  </div> 
  <p><span class="label label-success">Output</span></p> 
  <div> 
   <pre><tt>usage: aloha-cli -cp /path/to/some.jar:/path/to/other.jar:... [args to CLI]</tt></pre> 
  </div> 
  <p>So, it’s clear that some jar files need to be specified on the classpath to make the CLI work. Luckily, when aloha is built, the <i>aloha-cli</i> module has a jar that includes all of the necessary dependencies. This can be found automatically with the following shell script magic which looks in the target directory of the <i>aloha-cli</i> module for a jar with dependencies.</p> 
  <p>Let’s try running again with the proper jar on the classpath.</p> 
  <p><span class="label">Input</span></p> 
  <div class="source"> 
   <div class="source"> 
    <pre>aloha-cli/bin/aloha-cli                                    \
  -cp $(find aloha-cli -name &quot;*jar-with-dependencies.jar&quot;)
</pre> 
   </div> 
  </div> 
  <p><span class="label label-success">Output</span></p> 
  <div> 
   <pre><tt>No arguments supplied. Supply one of: '--dataset', '--modelrunner', '--vw'.</tt></pre> 
  </div> 
  <p>Now the CLI gets a little further. Let’s choose the <tt>--dataset</tt> option (<i>since we’re making a dataset</i>). </p> 
  <p><span class="label">Input</span></p> 
  <div class="source"> 
   <div class="source"> 
    <pre>aloha-cli/bin/aloha-cli                                    \
  -cp $(find aloha-cli -name &quot;*jar-with-dependencies.jar&quot;) \
  --dataset
</pre> 
   </div> 
  </div> 
  <p><span class="label label-success">Output</span></p> 
  <div> 
   <pre><tt>Error: Missing option --spec
Error: No output dataset type provided.  Provide at least one of: vw, vw_labeled, vw_cb, libsvm, libsvm_labeled, csv
dataset [ SOME ALOHA VERSION HERE ]
Usage: dataset [options]

  --cachedir &lt;value&gt;
        a cache directory
  --parallel &lt;value&gt;
        a list of Apache VFS URLs additional jars to be included on the classpath
  -s &lt;value&gt; | --spec &lt;value&gt;
        Apache VFS URL to a JSON specification file containing attributes of the dataset being created.
  -p &lt;value&gt; | --proto-input &lt;value&gt;
        canonical class name of the protocol buffer type to use.
  -c &lt;value&gt; | --csv-input &lt;value&gt;
        Apache VFS URL to JSON file specifying the structure of the CSV input.
  -i &lt;value&gt; | --in &lt;value&gt;
        Apache VFS URL to the input file.  If not supplied, STDIN will be used.
  --vw &lt;value&gt;
        produce an unlabeled VW dataset and place the output in the specified location.
  --vw_labeled &lt;value&gt;
        produce a labeled VW dataset and place the output in the specified location.
  --vw_cb &lt;value&gt;
        produce a contextual bandit VW dataset and place the output in the specified location.
  --libsvm &lt;value&gt;
        produce an unlabeled LIBSVM dataset and place the output in the specified location.
  --libsvm_labeled &lt;value&gt;
        produce a labeled LIBSVM dataset and place the output in the specified location.
  --csv &lt;value&gt;
        produce a CSV dataset and place the output in the specified location.
  --csv-headers
        Produce headers in CSV output.
  --csv-header-file &lt;value&gt;
        Write CSV headers to the designated file.
</tt></pre> 
  </div> 
  <p>So, now we’re getting somewhere. Now that we have the lay of the land, let’s create some small datasets for real.</p> 
 </div> 
</div> 
<div class="section"> 
 <h2 id="Examples">Examples</h2> 
 <div class="section"> 
  <h3 id="CSV_Input_Transformed_CSV_output">CSV Input, Transformed CSV output</h3> 
 </div> 
</div>
			</div>
		</div>
	</div>
	<div class="row columns columns2">
		<div class="span6">
			<h4 id="Command_and_Results">Command and Results</h4>
<p><span class="label">Input</span></p>
<div class="source"> 
 <div class="source"> 
  <pre># Creating an Aloha cache directory provides a speed up 
# when running multiple times.  
#
# The cache directory must exist if it's specified.
# 
mkdir -p /tmp/aloha-cache 2&gt;/dev/null
</pre> 
 </div> 
</div>
<div class="source"> 
 <div class="source"> 
  <pre># Read 2 rows of data from STDIN.
(
cat &lt;&lt;EOM
MALE,175,
FEMALE,,books|films|chinese food
EOM
) |\
aloha-cli/bin/aloha-cli                               \
  -cp $(find aloha-cli -name &quot;*.jar&quot; | grep dep)      \
  --dataset                                           \
  --cachedir /tmp/aloha-cache                         \
  -c $(find $PWD/aloha-core/src -name 'csv_types1.js')\
  -s $(find $PWD/aloha-core/src -name 'csv_spec2.js') \
  --csv -
</pre> 
 </div> 
</div>
<p><span class="label label-success">Output</span></p>
<div> 
 <pre>
MALE,170,0
FEMALE,NULL,3
</pre> 
</div>
<div class="section">      
</div>
		</div>
		<div class="span6">
			<h4 id="Files">Files</h4>
<p><span class="label label-info text-right">csv_types1.js</span></p>
<div class="source"> 
 <div class="source"> 
  <pre>{
  &quot;fs&quot;: &quot;,&quot;,
  &quot;ifs&quot;: &quot;|&quot;,
  &quot;missingData&quot;: &quot;NULL&quot;,
  &quot;errorOnOptMissingField&quot;: false,
  &quot;errorOnOptMissingEnum&quot;: false,
  &quot;columns&quot;: [
    { &quot;name&quot;: &quot;gender&quot;, &quot;type&quot;: &quot;enum&quot;,
      &quot;className&quot;: &quot;a.b.Gender&quot;, 
      &quot;values&quot;: [ &quot;MALE&quot;, &quot;FEMALE&quot; ] },
    { &quot;name&quot;: &quot;weight&quot;, &quot;type&quot;: &quot;int&quot;, 
      &quot;optional&quot;: true },
    { &quot;name&quot;: &quot;likes&quot;, &quot;type&quot;: &quot;string&quot;, 
      &quot;vectorized&quot;: true }
  ]
}
</pre> 
 </div> 
</div>
<p><span class="label label-info text-right">csv_spec2.js</span></p>
<div class="source"> 
 <div class="source"> 
  <pre>{
  &quot;separator&quot;: &quot;,&quot;,
  &quot;nullValue&quot;: &quot;NULL&quot;,
  &quot;encoding&quot;: &quot;regular&quot;,
  &quot;imports&quot;:[],
  &quot;features&quot;: [
    {&quot;name&quot;: &quot;gender&quot;, &quot;spec&quot;:&quot;${gender}&quot; },
    {&quot;name&quot;: &quot;weight&quot;, &quot;spec&quot;:&quot;${weight} / 10 * 10&quot; },
    {&quot;name&quot;: &quot;num_likes&quot;, &quot;spec&quot;:&quot;${likes}.size&quot; }
  ]
}
</pre> 
 </div> 
</div>
		</div>
	</div>
	<div class="row">
	</div>
	<div class="row">
		<div class="span12">
			<div class="body-content">
				<p>Let’s look at the CLI arguments and the file structure of the auxiliary we provied to examine what happened. We supplied: </p>
<ul> 
 <li><tt>--cachedir /tmp/aloha-cache</tt>: This is useful for avoiding recompilation of Aloha features across calls to the CLI. Try to specify a cache directory when possible. The directory must exist.</li> 
 <li><tt>-c $(find $PWD/aloha-core/src -name 'csv_types1.js')</tt> describes the structure of the CSV <b>INPUT</b> data used to construct the dataset. This isn’t necessary when using <a class="externalLink" href="https://developers.google.com/protocol-buffers/?hl=en">Protocol Buffer</a> input (<tt>-p</tt> flag).</li> 
 <li><tt>-s $(find $PWD/aloha-core/src -name 'csv_spec2.js')</tt> describes the <b>OUTPUT</b> format of the dataset.</li> 
 <li><tt>--csv -</tt> This option says that we want to create a <i>CSV</i> dataset. The <tt>-</tt> at the end of the option indicates that the output be directed to standard output (<i>STDOUT</i>).</li> 
</ul>
<div class="section"> 
 <h4 id="External_CSV_input_format_description">External CSV input format description</h4> 
 <p><tt>csv_types1.js</tt> is a JSON file describing the CSV input structure of the original data we are transforming. These files have 6 fields.</p> 
 <ul> 
  <li><tt>fs</tt>: The associated value is a string describing the <i>field separator</i>. For instance, with comma-delimited data, the value would be <tt>&quot;,&quot;</tt>; for tab-separated data, it would be <tt>&quot;\t&quot;</tt>.</li> 
  <li><tt>ifs</tt>: The <i>intra-field separator</i>. This is used when fields are <tt>vectorized</tt> to separate the values in a vectorized data within a column.</li> 
  <li><tt>missingData</tt>: This is the string which represents a missing value. For instance, <tt>NULL</tt> was used in the above example. If we set the second line in the input in the above example to <tt>FEMALE,NULL,books|films|chinese food</tt>, everything still works.</li> 
  <li><tt>errorOnOptMissingField</tt>: a Boolean telling whether to produce an error for the row when an optional field is missing. Currently, an error in an output line causes the line not to included in the resulting dataset, but the dataset creation process is not halted. <tt>false</tt> is recommended since it’s more forgiving; it allows rows with a missing value to be included in the dataset.</li> 
  <li><tt>errorOnOptMissingEnum</tt>: Similar to <tt>errorOnOptMissingField</tt>, this field tells whether to produce an error when an unknown value for an enumerated type is provided in the input data.</li> 
  <li><tt>columns</tt>: An array of column definitions. The order in which the columns appear in the array defined the expected column order in the CSV input.</li> 
 </ul> 
 <p>In the <tt>columns</tt> field, each associated value in the array is a JSON object. </p> 
 <ul> 
  <li><tt>name</tt>: This is the name of the field. This is important not just for documentation but for use in the output specification as well.</li> 
  <li><tt>type</tt>: one of { <tt>boolean</tt>, <tt>double</tt>, <tt>enum</tt>, <tt>float</tt>, <tt>int</tt>, <tt>long</tt>, <tt>string</tt> }</li> 
  <li><tt>optional</tt>: a Boolean value. <tt>true</tt> if the column’s value might <i>NOT</i> appear in the input data. The default when not provided is <tt>false</tt>.</li> 
  <li><tt>vectorized</tt>: a Boolean value. <tt>true</tt> if the column’s contains <i>zero or more</i> values. In case this is set to <tt>true</tt>, the <tt>ifs</tt> value is used to split the values in the column into a vector of values. When <tt>vectorized</tt> is not provided, its default value is <tt>false</tt>.</li> 
 </ul> 
</div>
<div class="section"> 
 <h3 id="Protocol_Buffer_input_Vowpal_Wabbit_output">Protocol Buffer input, Vowpal Wabbit output</h3> 
 <p>This example will show off a bunch of features not covered in the <a href="#CSV_Input_Transformed_CSV_output">CSV Input, Transformed CSV output</a> example. We’ll see how to used Protocol Buffer input data and output to a different output type, namely Vowpal Wabbit. We’ll also see how to specify an input and output file, rather relying on STDIN and STDOUT.</p> 
 <p>Let’s start by looking at the fields in the data that we’ll be working with in this example. To do so, just cat the User.proto file: </p> 
 <p><span class="label">Input</span></p> 
 <div class="source"> 
  <div class="source"> 
   <pre>cat aloha-core/src/test/proto/User.proto
</pre> 
  </div> 
 </div> 
 <p><span class="label label-success">Output</span></p> 
 <div> 
  <pre>
package com.eharmony.aloha.test.proto;

option java_outer_classname=&quot;Testing&quot;;

enum GenderProto {
    MALE   = 1;
    FEMALE = 2;
}

message PhotoProto {
    required int64  id = 1;
    optional int32 height = 2;
    optional double aspect_ratio = 3;
}

message UserProto {
    required int64 id = 1;
    optional string name = 2;
    optional GenderProto gender = 3;
    optional float bmi = 4;
    repeated PhotoProto photos = 5;
}
</pre> 
 </div> 
 <p>Now let’s create some data and then process it.</p> 
 <p><span class="label">Input</span></p> 
 <p>Create temporary input and output files:</p> 
 <div class="source"> 
  <div class="source"> 
   <pre>INFILE=$(mktemp -t example_input)
OUTFILE=$(mktemp -t example_output)
</pre> 
  </div> 
 </div> 
 <p>Fill the input file with base64-encoded UserProto data. This is the data that will be provided to the data scientist for analysis. Aloha is used to decode and transform with serialized data.</p> 
 <div class="source"> 
  <div class="source"> 
   <pre>(
cat &lt;&lt;EOM
CAESBEFsYW4YASUAALhBKg0IARABGQAAAAAAAPA/Kg0IAhACGQAAAAAAAABA
CAESBEthdGUYAioNCAMQAxkAAAAAAAAIQA==
EOM
) &gt;&gt; $INFILE
</pre> 
  </div> 
 </div> 
 <p>Run the CLI. Note we need the second entry in the <tt>-cp</tt> (classpath) flag because it is the jar that contains the protocol buffer definitions.</p> 
 <div class="source"> 
  <div class="source"> 
   <pre>aloha-cli/bin/aloha-cli                              \
  -cp $(find aloha-cli -name &quot;*.jar&quot; | grep dep):\
$(find aloha-core -name &quot;*.jar&quot; | grep test)         \
  --dataset                                          \
  -i $INFILE                                         \
  -s $(find $PWD/aloha-core/src -name 'proto_spec1.js')   \
  -p com.eharmony.aloha.test.proto.Testing.UserProto \
  --cachedir /tmp/aloha-cache                        \
  --vw $OUTFILE
</pre> 
  </div> 
 </div> 
 <p>Clean up temp files and print the output.</p> 
 <div class="source"> 
  <div class="source"> 
   <pre>rm -f $INFILE
cat $OUTFILE
rm -f $OUTFILE
</pre> 
  </div> 
 </div> 
 <p><span class="label label-success">Output</span></p> 
 <div> 
  <pre>
| name=Alan gender=MALE bmi:23 num_photos:2
| name=Kate gender=FEMALE bmi=UNK num_photos
</pre> 
 </div> 
 <p>Again, let’s look at the CLI arguments. We’ll only describe the parameters that differ from the CSV input example:</p> 
 <ul> 
  <li><tt>-i $INFILE</tt> This is an input file containing the data.</li> 
  <li><tt>-p com.eharmony.aloha.test.proto.Testing.UserProto</tt> Tells the CLI that the input will be protocol buffer data that will have the structure described by the <tt>com.eharmony.aloha.test.proto.Testing.UserProto</tt> class.</li> 
  <li><tt>--vw $OUTFILE</tt> output an unlabeled vowpal wabbit dataset and put it in the file pointed to by the $OUTFILE shell variable. Obviously, there’s no need for a variable here because we are just executing a shell command. The key is that the value containing the output file location is an Apache VFS URL.</li> 
 </ul> 
</div>
<div class="section"> 
 <h2 id="aOutput_specification_files">(Output) specification files</h2> 
 <p>All CLI-based dataset creation involves a specification file for the output type. In the <a href="#CSV_Input_Transformed_CSV_output">CSV example</a>, we used <a class="externalLink" href="https://github.com/eHarmony/aloha/blob/master/aloha-core/src/test/resources/com/eharmony/aloha/dataset/cli/csv_spec2.js">csv_spec2.js</a>. In the <a href="#Protocol_Buffer_input_Vowpal_Wabbit_output">Protocol Buffer example</a>, we used <a class="externalLink" href="https://github.com/eHarmony/aloha/blob/master/aloha-core/src/test/resources/com/eharmony/aloha/dataset/cli/proto_spec1.js">proto_spec1.js</a>. Note that these files have the same <tt>features</tt> array format, but some of the other fields vary. This is because there are innate differences in the <i>output type</i> of columns in each row emitted by the dataset creator. For instance, each column of a CSV dataset is a scalar value. This means the vector of columns is a dense vector format. In the case of vowpal wabbit output, the covariate data is inherently sparse in nature so key-value pairs are outputted.</p> 
 <div class="section"> 
  <h3 id="Common_fields">Common fields</h3> 
  <ul> 
   <li><tt>imports</tt> an array of strings. These imports that will be imported into scope for eeach feature definition. Wildcard imports are specified with an underscore. For instance, a common import one should consider is <tt>&quot;com.eharmony.aloha.feature.BasicFunctions._&quot;</tt></li> 
   <li><tt>features</tt> an array containing JSON objects which describe the features to be produced. More on this later.</li> 
  </ul> 
 </div> 
 <div class="section"> 
  <h3 id="CSV-specific_fields">CSV-specific fields</h3> 
  <ul> 
   <li><tt>separator</tt> the column delimiter. <tt>&quot;,&quot;</tt> for comma-delimited data, <tt>&quot;\t&quot;</tt> for tab-delimited.</li> 
   <li><tt>nullValue</tt> the string value to assign to a column when its data is missing. <tt>&quot;&quot;</tt> or <tt>&quot;NULL&quot;</tt>, for instance.</li> 
   <li><tt>encoding</tt> how categorical variables are encoded. Currently, this can be <tt>regular</tt> or <tt>hotOne</tt>. Regular encoding just creates a one-dimensional string representation of the value. <a class="externalLink" href="https://en.wikipedia.org/wiki/One-hot">Hot-one encoding</a> is a binarized vector representation of the feature.</li> 
  </ul> 
 </div> 
 <div class="section"> 
  <h3 id="features">features</h3> 
  <p>Each feature has three values: * <tt>name</tt> the name of the feature * <tt>spec</tt> how to compute the feature (scala code with the imports in the <tt>imports</tt> array in scope) * <tt>defVal</tt> a default value. This field is optional. If omitted, the <tt>nullValue</tt> value will be used if necessary in the CSV case and an empty sequence of key-value pairs will be used in the case of sparse formats like VW and LIBSVM.</p> 
 </div> 
 <div class="section"> 
  <h3 id="A_word_of_sparse_formats">A word of sparse formats</h3> 
  <p>Each feature in a sparse dataset type outputs a sequence of key-value pairs. This can be <i>zero or more</i>. If the sequence sizes for each feature are exactly <i>zero</i> or <i>one</i>, the same specification file can be used for both dense (CSV) or sparse (VW, LIBSVM) dataset creation. By importing <tt>com.eharmony.aloha.feature.BasicFunctions._</tt>, a conversion mechanism is brought into scope. So when specifying a feature like: </p> 
  <div class="source"> 
   <div class="source"> 
    <pre>{ 
  &quot;name&quot;: &quot;some_feature_name&quot;, 
  &quot;spec&quot;: &quot;${some.extracted.scalar.number}&quot;
}
</pre> 
   </div> 
  </div> 
  <p>and assuming a datum passed into the dataset CLI has a value of <tt>7</tt> associated with the field <tt>some.extracted.scalar.number</tt>, Aloha can automatically generate a sequence of one key-value pair: <tt>[ &quot;some_feature_name&quot; -&gt; 7) ]</tt>.</p> 
 </div> 
 <div class="section"> 
  <h3 id="Multiple_dataset_formats">Multiple dataset formats</h3> 
  <p>Additionally, the dataset creator ignores JSON fields in the specification file that aren’t used by the desired dataset type. This means that if we provide a union of fields used by multiple dataset creators, we can those to generate two or more datasets of different types at once. We just need to make sure the destination files differ. For instance:</p> 
  <p>Create the files again (like above):</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>INFILE=$(mktemp -t example_input)
OUTFILE_CSV=$(mktemp -t example_output)
OUTFILE_VW=$(mktemp -t example_output)
</pre> 
   </div> 
  </div> 
  <p>Create the protocol buffer input again (like above):</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>(
cat &lt;&lt;EOM
CAESBEFsYW4YASUAALhBKg0IARABGQAAAAAAAPA/Kg0IAhACGQAAAAAAAABA
CAESBEthdGUYAioNCAMQAxkAAAAAAAAIQA==
EOM
) &gt;&gt; $INFILE
</pre> 
   </div> 
  </div> 
  <p>Run the CLI. Here we create two datasets simultaneously from the same protocol buffer input data and the same specification file, <a class="externalLink" href="https://github.com/eHarmony/aloha/blob/master/aloha-core/src/test/resources/com/eharmony/aloha/dataset/cli/csv_AND_vw_spec.js">csv_AND_vw_spec.js</a>. We give headers to the CSV file. Everything else is the same.</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>aloha-cli/bin/aloha-cli                                     \
  -cp $(find aloha-cli -name &quot;*.jar&quot; | grep dep):\
$(find aloha-core -name &quot;*.jar&quot; | grep test)                \
  --dataset                                                 \
  -i $INFILE                                                \
  -s $(find $PWD/aloha-core/src -name 'csv_AND_vw_spec.js') \
  -p com.eharmony.aloha.test.proto.Testing.UserProto        \
  --cachedir /tmp/aloha-cache                               \
  --vw_labeled  $OUTFILE_VW                                 \
  --csv $OUTFILE_CSV                                        \
  --csv-headers
</pre> 
   </div> 
  </div> 
  <div class="source"> 
   <div class="source"> 
    <pre>cat $OUTFILE_CSV
</pre> 
   </div> 
  </div> 
  <p><span class="label label-success">Output</span></p> 
  <div> 
   <pre>
csv_label,gender,bmi,num_photos,avg_photo_height
1,0,23.0,2,1
1,1,NULL,1,3
</pre> 
  </div> 
  <div class="source"> 
   <div class="source"> 
    <pre>cat $OUTFILE_VW
</pre> 
   </div> 
  </div> 
  <p><span class="label label-success">Output</span></p> 
  <div> 
   <pre>
1 1|ignored csv_label |personal bmi:23 |photos num_photos:2 avg_photo_height
1 1|ignored csv_label |personal gender |photos num_photos avg_photo_height:3
</pre> 
  </div> 
 </div> 
</div>
			</div>
		</div>
	</div>
	</div>

	</div><!-- /container -->

	<!-- Footer
	================================================== -->
	<footer class="well">
		<div class="container">
			<div class="row">
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Main</li>
						<li >
							<a href="./" title="Home">Home</a>
						</li>
						<li class="nav-header">Maven Documentation</li>
						<li >
							<a href="project-info.html" title="Project Information">Project Information <i class="icon-chevron-right"></i></a>
						</li>
						<li >
							<a href="project-reports.html" title="Project Reports">Project Reports <i class="icon-chevron-right"></i></a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">API Docs</li>
						<li >
							<a href="aloha-core/scaladocs/index.html" title="aloha-core">aloha-core</a>
						</li>
						<li >
							<a href="aloha-vw-jni/scaladocs/index.html" title="aloha-vw-jni">aloha-vw-jni</a>
						</li>
						<li >
							<a href="aloha-h2o/scaladocs/index.html" title="aloha-h2o">aloha-h2o</a>
						</li>
						<li >
							<a href="aloha-cli/scaladocs/index.html" title="aloha-cli">aloha-cli</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Contribute</li>
						<li >
							<a href="http://github.com/eharmony/aloha/" title="Fork on GitHub" class="externalLink">Fork on GitHub</a>
						</li>
						<li >
							<a href="http://github.com/eharmony/aloha/issues/" title="Issues" class="externalLink">Issues</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-description">
					<blockquote><span class="color-highlight">Aloha</span> is a scala-based feature generation and modeling framework.</blockquote>
				</div>
			</div>
		</div>
	</footer>

	<div class="container subfooter">
		<div class="row">
			<div class="span12">
				<p class="pull-right"><a href="#">Back to top</a></p>
				<p class="copyright">Copyright &copy;2013-2016 <a href="http://eharmony.com">eHarmony</a>. All Rights Reserved.</p>
				<p class="version-date"><span class="projectVersion">Version: 3.3.0. </span><span class="publishDate">Last Published: 2016-06-19. </span></p>
					</div>
		</div>
	</div>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

	<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script src=".//js/lightbox.min.js"></script>
	<script src=".//js/reflow-scroll.js"></script>
	
<script src=".//js/highlight/highlight.pack.js"></script>
	<script src=".//js/reflow-skin.js"></script>

	</body>
</html>
